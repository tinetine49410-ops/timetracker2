<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TimeTracker ‚Äî Connexion</title>

  <!-- Supabase (1 seule fois) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Arial;background:#05060a;color:#fff}
    .overlay{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:420px;background:#0f172a;border-radius:18px;padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.45)}
    h1{margin:0 0 16px;font-size:26px}
    input{width:100%;box-sizing:border-box;padding:12px 14px;border-radius:10px;border:0;margin:10px 0;font-size:15px}
    button{width:100%;padding:12px 14px;border-radius:12px;border:0;font-weight:800;font-size:15px;cursor:pointer;margin-top:10px}
    .green{background:#10b981}
    .blue{background:#2563eb;color:#fff}
    .msg{margin-top:12px;opacity:.95;font-size:14px;min-height:20px}
  </style>
</head>

<body>
  <div class="overlay">
    <div class="card">
      <h1>üîí Connexion</h1>

      <input id="email" type="email" placeholder="email" autocomplete="email" />
      <input id="password" type="password" placeholder="mot de passe" autocomplete="current-password" />

      <button class="green" id="btnLogin">Se connecter</button>
      <button class="blue" id="btnRegister">Cr√©er un compte</button>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <script>
    // ‚úÖ Mets TES infos Supabase ici
    const SUPABASE_URL = "COLLE_ICI_TON_SUPABASE_URL";
    const SUPABASE_ANON_KEY = "COLLE_ICI_TON_SUPABASE_ANON_KEY";

    // ‚úÖ client Supabase (on l'appelle sb, PAS supabase)
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $ = (id) => document.getElementById(id);
    const setMsg = (t) => $("msg").textContent = t || "";

    async function goApp() {
      // redirige vers app.html
      window.location.href = "./app.html";
    }

    async function checkSessionOnLoad() {
      const { data } = await sb.auth.getSession();
      if (data.session) goApp();
    }

    $("btnLogin").addEventListener("click", async () => {
      setMsg("Connexion...");
      const email = $("email").value.trim();
      const password = $("password").value;

      const { data, error } = await sb.auth.signInWithPassword({ email, password });
      if (error) return setMsg("‚ùå " + error.message);

      setMsg("‚úÖ Connexion r√©ussie");
      goApp();
    });

    $("btnRegister").addEventListener("click", async () => {
      setMsg("Cr√©ation du compte...");
      const email = $("email").value.trim();
      const password = $("password").value;

      const { data, error } = await sb.auth.signUp({ email, password });
      if (error) return setMsg("‚ùå " + error.message);

      setMsg("‚úÖ Compte cr√©√©. (Tu peux te connecter)");
      // parfois Supabase demande validation email selon r√©glage
    });

    checkSessionOnLoad();
  </script>
</body>
</html>
