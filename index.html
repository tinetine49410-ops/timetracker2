<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TimeTracker ‚Äî Connexion</title>
  <style>
    :root{--card:#101b2f;--border:#1f2b44;--txt:#e5e7eb;--muted:#94a3b8;--green:#10b981;--blue:#2563eb;--red:#ef4444}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:#000}
    .wrap{width:100%;max-width:520px;padding:18px}
    .card{background:rgba(16,27,47,.95);border:1px solid rgba(31,43,68,.9);border-radius:22px;padding:22px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
    h1{margin:0 0 8px;font-size:26px;color:var(--txt)}
    p{margin:0 0 14px;color:var(--muted);font-size:13px}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:12px}
    input{width:100%;padding:14px 14px;border-radius:14px;border:1px solid rgba(31,43,68,.9);background:rgba(255,255,255,.06);color:var(--txt);outline:none}
    .row{display:flex;gap:10px;margin-top:12px}
    button{flex:1;padding:14px;border:none;border-radius:14px;font-weight:900;cursor:pointer}
    .b1{background:var(--green);color:#062014}
    .b2{background:var(--blue);color:#06122a}
    .msg{margin-top:12px;padding:12px;border-radius:14px;border:1px solid rgba(31,43,68,.9);color:var(--txt);font-size:13px;min-height:44px;display:flex;align-items:center}
    .ok{border-color:rgba(16,185,129,.45)}
    .bad{border-color:rgba(239,68,68,.45)}
    .small{margin-top:10px;font-size:12px;color:var(--muted)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>üîí Connexion</h1>
      <p>Connexion e-mail / mot de passe (Supabase).</p>

      <label>Email</label>
      <input id="email" type="email" autocomplete="email" />

      <label>Mot de passe</label>
      <input id="password" type="password" autocomplete="current-password" />

      <div class="row">
        <button id="btnLogin" class="b1">Se connecter</button>
        <button id="btnSignup" class="b2">Cr√©er un compte</button>
      </div>

      <div id="msg" class="msg">Pr√™t.</div>
      <div class="small">Apr√®s connexion, tu es envoy√© vers <b>app.html</b>.</div>
    </div>
  </div>

  <!-- ‚úÖ Supabase UMD (pas module) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <script>
    // ‚úÖ Tes infos
    const SUPABASE_URL = "https://nqmfrvargnwgcavmymwh.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_I2iHiULq2tMdZZpEUEKXgg_wer0lyAH";

    const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const $ = (id)=>document.getElementById(id);
    const msgEl = $("msg");

    function setMsg(text, type=""){
      msgEl.className = "msg " + (type || "");
      msgEl.textContent = text;
    }

    async function init(){
      const { data } = await sb.auth.getSession();
      if (data && data.session) location.href = "./app.html";
    }
    init();

    $("btnLogin").addEventListener("click", async () => {
      try{
        const email = $("email").value.trim();
        const password = $("password").value;
        if(!email || !password) return setMsg("‚ùå Renseigne email + mot de passe.", "bad");

        setMsg("Connexion...");
        const { error } = await sb.auth.signInWithPassword({ email, password });
        if (error) return setMsg("‚ùå " + error.message, "bad");

        setMsg("‚úÖ Connexion r√©ussie.", "ok");
        location.href = "./app.html";
      }catch(e){
        setMsg("‚ùå " + (e?.message || e), "bad");
      }
    });

    $("btnSignup").addEventListener("click", async () => {
      try{
        const email = $("email").value.trim();
        const password = $("password").value;
        if(!email || !password) return setMsg("‚ùå Renseigne email + mot de passe.", "bad");

        setMsg("Cr√©ation du compte...");
        const { error } = await sb.auth.signUp({ email, password });
        if (error) return setMsg("‚ùå " + error.message, "bad");

        setMsg("‚úÖ Compte cr√©√©. Tu peux te connecter.", "ok");
      }catch(e){
        setMsg("‚ùå " + (e?.message || e), "bad");
      }
    });
  </script>
</body>
</html>
